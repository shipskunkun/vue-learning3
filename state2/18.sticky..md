####  2 Sticky需求分析

查看长啥样：stickyjs.com

就是页面滚动，往下滑的时候，还能看见

当页面滚动至下方，原本静态布局的「演职员表」将变为fixed布局，固定在页面顶部。



如何实现：

自己的猜想，监听scroll 事件，当scrollHeight 大于某个值的时候，修改目标元素的 position，为fixed

当scroll height 小于某个值的时候，去掉绝对定位的 class



getBoundingClientRect

获取的top , 元素上边到视窗上边的距离;

元素距离文档顶部高度 =  el.getBoundingClientRect().top  +  scrollY



当元素处于屏幕上方，top值为负值。



#### 3  解决Sticky的四个bug

关键问题：

什么时候动态添加class，设置 sticky 元素为 fixed?

可能出现的bug？

1. 为什么会闪烁，fixed 元素一会儿没超过，一会儿超过了？

打印出bug，看出top 值一直在变化，这是不可取的

最好一开始计算 top



2. 为什么滚不动？滚动不生效？

   存在某种情况，当sticky存在的时候，sticky高度+内容高度 会有 滚动条

   但是 sticky fixed 定位，内容高度不足以 滚动

   存在，不能滚动bug， scrollY 为0， 退出 fixed 状态，循环



​		解决办法：不要影响原有文档的高度

​		获取初始文档高度，在滚动时候，设置



3. 有事高度需要延迟获取，获取的高度不一定是正确的高度

   比如会出现有图片的情况，图片没加载就获取高度，开始没能获取全部高度

   如何解决？

   只能在图片变成 fixed 的之后的前一秒，获取高度



4. 如果div 不是在页面顶部如何实现？

   假如这个div 在页面的中间、底部、左侧？

   动态修改，left、top、width、height

   

   

#### 4  热更新与beforeDestroy

webpack 机制，修改了谁，修改了组件，会重新刷新组件，把之前的组件从页面移除，然后再render，把新的组件加到相同位置

新旧组件都会监听当前窗口，所以会报错

需要再 beforeDestroy ，消除监听事件



闭包中的this 都是window

```js
this.windowScrollHandler = this._windowScrollHandler.bind(this)// 如果不写这句话
window.addEventListener('scroll', this.windowScrollHandler) // this是window
```



#### 5 函数debounce

```js
if(this.timer){
	clearTimeout
}
this.timer = fn;
```



lodash 提供了， debounce 方法



#### 6  完善Sticky
#### 7  timerId写在data里有问题吗
#### 8 为什么组件的data必须是函数