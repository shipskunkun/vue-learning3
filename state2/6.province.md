

### 6. 省市级联组件



参考，Element  cascader 组件

级联选择组件

1. 点击选择子组件，一层一层点
   1. 判断孩子节点是否是叶子节点
   2. 叶子节点，选择，否，继续展开
2. hover选择子组件，
3. 禁用item
   1. 某些省不能用，如不包邮地区
4. 删除选中结果
5. 展示选中结果，三层都展示，只展示最后一层
6. 多选、单选
7. 动态加载
   1. 给组件传递一个 function
8. 可搜索





#### 3. 视频 省市区层级选择组件

美团城市，做成静态页面

把所有城市展示出来，比三级页面选择更好

房天下，也是



总体思路：

toggle，点击，展开，选中值，改变选中值，异步加载数据

肯定有个递归组件，因为要判断何时停止渲染自身

​	逻辑：接受参数 source, 如果有children，展示子组件，   v-for children ， 把 item当 sourceItem 传给 子组件

​	

click item， 展开孩子节点，选中

​		如何获取选中 item ？

​		点击获取 item， 并通过 source查询 item的children，作为level2 数据

右边孩子节点，来源，显示

​	点击第一层item，获取第二层item数据、并展示



vue 中的属性，不能以 data- 开头

#### 4. 视频 渲染弹出内容

#### 5.视频 递归渲染

待递归组件：

先遍历渲染level1 item name， 点击name， 拿到右侧数据，递归自己

```vue



<cascader-items :items="source" class="popover" :loadData="loadData"
        :loading-item="loadingItem"
        :height="popoverHeight" 
        :selected="selected" 
        @update:selected="onUpdateSelected">
</cascader-items>

<div class="cascaderItem" :style="{height: height}">
    <div class="left">
      <div class="label" v-for="item in items" @click="onClickLabel(item)">
        <span class="name">{{item.name}}</span>
        <span class="icons">
          <template v-if="item.name === loadingItem.name">  当前选中的item icon
            <icon class="loading" name="loading"></icon>
          </template>
          <template v-else>  没有选中的其他的item 的icon
            <icon class="next" v-if="rightArrowVisible(item)" name="right"></icon>
          </template>
        </span>
      </div>
    </div>
    <div class="right" v-if="rightItems">  // 由 clickLabel 获得
      <gulu-cascader-items ref="right" :items="rightItems" :height="height"
        :loading-item="loadingItem"
        :load-data="loadData"
        :level="level+1" :selected="selected" @update:selected="onUpdateSelected"></gulu-cascader-items>
    </div>
  </div>
```

#### 

什么时候item 显示右箭头？

​	有 children





#### 6. 视频 添加样式时发现 parcel 有问题
#### 7. 视频 （可选）尝试使用 webpack@4 失败

6、7、8  TODO 



#### 9. 尝试点击level1，隐藏level3 失败

#### 10. 使用单数据流简化问题

如何点击 level1 的时候，更新 level3？



如何理解单项数据流？

> 非单项数据流：

两个孩子都能修改同一个父组件的值，两个孩子 和 父组件，都有双向数据流，都能修改和获取父组件的值

> 单项数据流：

孩子不能直接修改父组件的值，通过 emit 通知父组件，父组件值修改后，子组件获得新值

> Vue不允许子组件修改prop

子组件通过 emit 通知父组件



我们通过点击的时候，修改 selected 的值，相当于（老爸的银行卡），孩子能都获得

递归组件接受一个选中值，如果有选中值，我们 右侧level+1 的数据，由 选中值 + level 获取



selected 值是什么？

是一个对象，如杭州、上城、下城，有好几层的对象。



```vue
//最外侧，使用组件
<g-cascader :source="source" :selected="selected"> </g-cascader>
```

点击 item，通知父组件，通知最外层，修改 selected ，最要修改最顶级的，最外侧的父组件的值，即可

eventBus 相当于 最顶级的 redux 



#### 11.使用递归算法找出被选中的item

demo 代码在视频，第8节，15min 开始

实验代码在，demo-view-cascader-demo 中



